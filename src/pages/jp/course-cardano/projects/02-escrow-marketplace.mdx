---
title: P2Pエスクロー
description: AikenとMesh SDKを使用して、マルチパーティ署名、時間ベースの紛争処理、オンチェーン状態追跡を備えたCardano上のエスクロースマートコントラクトを構築します。
asIndexPage: true
sidebarTitle: 2. P2Pエスクロー
---

# プロジェクト #02: 紛争解決機能付きP2Pエスクロー

**難易度:** 上級 | **レッスン:** 1–8

買い手が資金をロックし、売り手が納品を行い、独立した仲裁者が紛争を解決するエスクロースマートコントラクトを構築します。

## 要件

### 1. エスクローバリデータ

3つの結果パターンを持つAiken Spendingバリデータを作成します:
- **リリース**: 買い手が署名して売り手に資金を解放する
- **返金**: 売り手が署名して買い手に資金を返金する
- **紛争**: 設定可能なタイムアウト期間内にどちらの当事者も行動しない場合、仲裁者が裁定を下し、いずれかの当事者に資金を送金できる

### 2. Withdraw-Zeroによる共有バリデーション

Withdraw-Zeroパターン（レッスン5）を使用して、共通チェック（有効な署名、タイムアウトロジック）をWithdrawalバリデータに集約し、リリース、返金、紛争の各パスにおけるスクリプトサイズを削減します。

### 3. 状態追跡

オラクルスタイルのDatum（レッスン8にインスパイア）を使用して、エスクローの状態をオンチェーンで追跡します:
- `Created`: 資金がロックされ、納品を待機中
- `Delivered`: 売り手が納品を申告し、買い手の確認を待機中
- `Resolved`: 適切な当事者に資金が解放済み

### 4. コントラクトテスト

以下をカバーする包括的なテストを作成します:
- 納品後の買い手による正常なリリース
- 納品前の売り手による正常な返金
- タイムアウトによる仲裁者の解決
- 買い手の署名なしでのリリース拒否
- タイムアウト前の紛争拒否

### 5. オフチェーンコード

フルライフサイクルの実行可能なスクリプトを提供します:
- エスクローの作成（買い手、売り手、仲裁者、タイムアウトを指定したDatumで資金をロック）
- 納品済みとしてマーク（売り手が状態を更新）
- 資金のリリース（買い手が確認）
- 紛争解決（タイムアウト後に仲裁者が対応）

## 実証されるスキル

- トランザクション構築とマルチパーティ署名（レッスン1–2）
- 複雑なRedeemerロジックを持つAikenバリデータ（レッスン3）
- 徹底的なコントラクトテスト（レッスン4）
- 共有バリデーションのためのWithdraw-Zeroパターン（レッスン5）
- Blueprintの解釈（レッスン6）
- 時間ベースのアンロックロジック（レッスン7）
- Datumによるオンチェーン状態管理（レッスン8）
